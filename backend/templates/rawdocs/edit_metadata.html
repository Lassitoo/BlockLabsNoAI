{% extends "base.html" %}
{% load static %}
{% block title %}Édition complète - {{ doc.title|default:'Document' }}{% endblock %}

{% block extra_css %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
    :root {
        --primary: #0ea5e9;
        --primary-light: #38bdf8;
        --primary-dark: #0284c7;
        --accent: #10b981;
        --accent-light: #34d399;
        --secondary: #8b5cf6;
        --warning: #f59e0b;
        --error: #dc2626;
        --success: #16a34a;
        --text: #000000;
        --text-muted: #6b7280;
        --text-secondary: #4b5563;
        --card-bg: rgba(255, 255, 255, 0.95);
        --card-border: rgba(14, 165, 233, 0.15);
        --glass-bg: rgba(255, 255, 255, 0.8);
        --hover-bg: rgba(255, 255, 255, 0.9);
        --shadow: 0 8px 32px rgba(14, 165, 233, 0.12);
        --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.15);
    }

    /* Layout Principal */
    .editor-container {
        max-width: 1400px;
        margin: 1rem auto;
        padding: 0 1rem;
        min-height: calc(100vh - 80px);
    }

    /* Header Moderne */
    .document-header {
        position: relative;
        overflow: hidden;
        border-radius: 24px;
        padding: 2rem;
        color: #fff;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 40%, var(--secondary) 100%);
        box-shadow: var(--shadow-lg);
        margin-bottom: 2rem;
        backdrop-filter: blur(20px);
    }

    .document-header::before {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, .1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 255, 255, .08) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, .06) 0%, transparent 50%);
        animation: float 20s ease-in-out infinite;
        pointer-events: none;
    }

    @keyframes float {
        0%, 100% {
            transform: translateY(0px) rotate(0deg);
        }
        33% {
            transform: translateY(-10px) rotate(1deg);
        }
        66% {
            transform: translateY(5px) rotate(-1deg);
        }
    }

    .header-content {
        position: relative;
        z-index: 2;
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 1.5rem;
        align-items: center;
    }

    .doc-icon {
        width: 80px;
        height: 80px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(12px);
        border: 2px solid rgba(255, 255, 255, 0.25);
    }

    .doc-icon i {
        font-size: 2rem;
        color: #fff;
    }

    .doc-info h1 {
        margin: 0 0 0.5rem 0;
        font-size: 2rem;
        font-weight: 900;
        letter-spacing: -0.02em;
    }

    .doc-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.9rem;
        opacity: 0.9;
    }

    .header-actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    /* Navigation par onglets */
    .tab-navigation {
        display: flex;
        background: var(--glass-bg);
        border-radius: 16px;
        padding: 0.5rem;
        margin-bottom: 2rem;
        backdrop-filter: blur(20px);
        border: 1px solid var(--card-border);
        box-shadow: var(--shadow);
    }

    .tab-btn {
        flex: 1;
        padding: 1rem 1.5rem;
        border: none;
        background: transparent;
        color: var(--text-muted);
        font-weight: 600;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        position: relative;
        overflow: hidden;
    }

    .tab-btn::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        opacity: 0;
        transition: opacity 0.3s ease;
        border-radius: 12px;
    }

    .tab-btn.active {
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 8px 25px rgba(14, 165, 233, 0.3);
    }

    .tab-btn.active::before {
        opacity: 1;
    }

    .tab-btn span {
        position: relative;
        z-index: 2;
    }

    .tab-btn:hover:not(.active) {
        background: rgba(14, 165, 233, 0.1);
        color: var(--primary);
    }

    /* Contenu des onglets */
    .tab-content {
        display: none;
        animation: fadeInUp 0.5s ease-out;
    }

    .tab-content.active {
        display: block;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Cards */
    .editor-card {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--card-border);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .editor-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        border-radius: 20px 20px 0 0;
    }

    .editor-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 16px 40px rgba(14, 165, 233, 0.2);
    }

    .card-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-dark);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    /* Grille des métadonnées */
    .metadata-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .form-field {
        position: relative;
    }

    .form-label {
        display: block;
        font-weight: 600;
        color: var(--primary-dark);
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    .form-input {
        width: 100%;
        padding: 0.875rem 1rem;
        background: var(--glass-bg);
        border: 2px solid var(--card-border);
        border-radius: 12px;
        color: var(--text);
        font-size: 1rem;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
        background: rgba(255, 255, 255, 0.95);
        transform: translateY(-1px);
    }

    .form-input::placeholder {
        color: var(--text-muted);
        opacity: 0.7;
    }

    /* Badges */
    .auto-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        padding: 0.25rem 0.6rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-left: 0.5rem;
    }

    .auto-badge.extracted {
        background: rgba(16, 185, 129, 0.1);
        color: var(--accent);
    }

    .auto-badge.detected {
        background: rgba(14, 165, 233, 0.1);
        color: var(--primary);
    }

    .auto-badge.custom {
        background: rgba(139, 92, 246, 0.1);
        color: var(--secondary);
    }

    /* Boutons */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.95rem;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        text-decoration: none;
    }

    .btn::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transform: translateX(-100%);
        transition: transform 0.6s;
    }

    .btn:hover::before {
        transform: translateX(100%);
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: white;
        box-shadow: 0 8px 25px rgba(14, 165, 233, 0.3);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(14, 165, 233, 0.4);
    }

    .btn-secondary {
        background: transparent;
        color: var(--primary);
        border: 2px solid var(--primary);
    }

    .btn-secondary:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-1px);
    }

    .btn-success {
        background: linear-gradient(135deg, var(--success), var(--accent));
        color: white;
    }

    .btn-warning {
        background: linear-gradient(135deg, var(--warning), #fb923c);
        color: white;
    }

    .btn-danger {
        background: linear-gradient(135deg, var(--error), #f87171);
        color: white;
    }

    /* Actions flottantes */
    .floating-actions {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        z-index: 100;
    }

    .floating-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: white;
        border: none;
        cursor: pointer;
        box-shadow: 0 8px 25px rgba(14, 165, 233, 0.3);
        transition: all 0.3s ease;
        font-size: 1.25rem;
    }

    .floating-btn:hover {
        transform: translateY(-3px) scale(1.1);
        box-shadow: 0 15px 40px rgba(14, 165, 233, 0.4);
    }

    /* Éditeur de contenu */
    .content-editor {
        position: relative;
        min-height: 600px;
    }

    .editor-toolbar {
        display: flex;
        gap: 1rem;
        padding: 1rem;
        background: var(--glass-bg);
        border-radius: 12px;
        margin-bottom: 1rem;
        backdrop-filter: blur(20px);
        border: 1px solid var(--card-border);
        flex-wrap: wrap;
        align-items: center;
    }

    .editor-content {
        background: white;
        border: 2px solid var(--card-border);
        border-radius: 16px;
        min-height: 500px;
        padding: 2rem;
        transition: border-color 0.3s ease;
        position: relative;
        overflow: auto;
    }

    .editor-content:focus-within {
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
    }

    /* Mode édition */
    .edit-mode [contenteditable="true"] {
        outline: 2px dashed rgba(14, 165, 233, 0.3);
        outline-offset: 2px;
        background: rgba(14, 165, 233, 0.02);
        transition: all 0.3s ease;
    }

    .edit-mode [contenteditable="true"]:hover {
        outline-color: var(--primary);
        background: rgba(14, 165, 233, 0.05);
    }

    .edit-mode [contenteditable="true"]:focus {
        outline: 2px solid var(--primary);
        background: rgba(14, 165, 233, 0.08);
        box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
    }

    /* Vue comparative */
    .comparison-view {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        height: 80vh;
    }

    .comparison-panel {
        border: 1px solid var(--card-border);
        border-radius: 16px;
        overflow: hidden;
        background: white;
        display: flex;
        flex-direction: column;
    }

    .panel-header {
        padding: 1rem 1.5rem;
        font-weight: 600;
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .panel-header.structured {
        background: linear-gradient(135deg, var(--primary), var(--accent));
    }

    .panel-header.pdf {
        background: linear-gradient(135deg, var(--error), #fb7185);
    }

    .panel-content {
        flex: 1;
        overflow: auto;
        position: relative;
    }

    .pdf-frame {
        width: 100%;
        height: 100%;
        border: none;
    }

    /* Historique */
    .history-entry {
        background: var(--glass-bg);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }

    .history-entry:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 15px rgba(14, 165, 233, 0.1);
    }

    .history-field {
        font-weight: 600;
        color: var(--primary-dark);
        margin-bottom: 0.5rem;
    }

    .history-change {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
    }

    .history-meta {
        display: flex;
        justify-content: between;
        align-items: center;
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    /* Toast notifications */
    .toast {
        position: fixed;
        top: 2rem;
        right: 2rem;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        color: white;
        font-weight: 600;
        z-index: 1000;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .toast.show {
        transform: translateX(0);
    }

    .toast.success {
        background: linear-gradient(135deg, var(--success), var(--accent));
    }

    .toast.error {
        background: linear-gradient(135deg, var(--error), #f87171);
    }

    .toast.warning {
        background: linear-gradient(135deg, var(--warning), #fb923c);
    }

    /* Responsive */
    @media (max-width: 1200px) {
        .comparison-view {
            grid-template-columns: 1fr;
            height: auto;
        }

        .comparison-panel {
            min-height: 400px;
        }
    }

    @media (max-width: 768px) {
        .editor-container {
            padding: 0 0.5rem;
        }

        .document-header {
            padding: 1.5rem;
            border-radius: 16px;
        }

        .header-content {
            grid-template-columns: 1fr;
            gap: 1rem;
            text-align: center;
        }

        .doc-info h1 {
            font-size: 1.5rem;
        }

        .metadata-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .tab-navigation {
            flex-direction: column;
            gap: 0.5rem;
        }

        .editor-toolbar {
            flex-direction: column;
            align-items: stretch;
        }

        .floating-actions {
            bottom: 1rem;
            right: 1rem;
        }

        .floating-btn {
            width: 50px;
            height: 50px;
            font-size: 1rem;
        }
    }

    @media (max-width: 480px) {
        .doc-icon {
            width: 60px;
            height: 60px;
        }

        .doc-icon i {
            font-size: 1.5rem;
        }

        .editor-card {
            padding: 1rem;
            border-radius: 16px;
        }

        .form-input {
            padding: 0.75rem;
        }
    }

    /* États de chargement */
    .loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
    }

    .loading::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
        0% {
            transform: translateX(-100%);
        }
        100% {
            transform: translateX(100%);
        }
    }

    /* États vides */
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-muted);
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .empty-state h3 {
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
    }

    /* Animations d'entrée */
    .fade-in {
        animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .slide-up {
        animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="editor-container">
    <!-- Header du document -->
    <div class="document-header">
        <div class="header-content">
            <div class="doc-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="doc-info">
                <h1>{{ doc.title|default:'Document sans titre' }}</h1>
                <div class="doc-meta">
                    <span><i class="fas fa-hashtag"></i> Doc #{{ doc.id }}</span>
                    {% if doc.doc_type %}<span><i class="fas fa-tag"></i> {{ doc.doc_type }}</span>{% endif %}
                    {% if doc.language %}<span><i class="fas fa-language"></i> {{ doc.language }}</span>{% endif %}
                    {% if doc.country %}<span><i class="fas fa-globe"></i> {{ doc.country }}</span>{% endif %}
                </div>
            </div>
            <div class="header-actions">
                <a href="{% url 'rawdocs:document_list' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Retour
                </a>
                <a href="{{ doc.file.url }}" target="_blank" class="btn btn-secondary">
                    <i class="fas fa-external-link-alt"></i> PDF
                </a>
                <button type="button" class="btn btn-warning" onclick="reextractMetadata()">
                    <i class="fas fa-sync"></i> Réextraire
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation par onglets -->
    <div class="tab-navigation">
        <button class="tab-btn active" data-tab="metadata">
            <span><i class="fas fa-edit"></i> Métadonnées</span>
        </button>
        <button class="tab-btn" data-tab="content">
            <span><i class="fas fa-layer-group"></i> Contenu structuré</span>
        </button>
        <button class="tab-btn" data-tab="comparison">
            <span><i class="fas fa-columns"></i> Vue comparative</span>
        </button>
        <button class="tab-btn" data-tab="history">
            <span><i class="fas fa-history"></i> Historique</span>
        </button>
    </div>

    <!-- Contenu des onglets -->

    <!-- Onglet Métadonnées -->
    <div class="tab-content active" id="tab-metadata">
        <div class="editor-card">
            <h2 class="card-title">
                <i class="fas fa-edit"></i>
                Édition des métadonnées
            </h2>

            <form id="metadataForm" method="post">
                {% csrf_token %}
                <input type="hidden" name="doc_id" value="{{ doc.id }}">
                <input type="hidden" name="edit_metadata" value="1">

                <div class="metadata-grid">
                    <div class="form-field">
                        <label class="form-label">
                            Titre du document
                            {% if metadata.title %}<span class="auto-badge extracted"><i class="fas fa-magic"></i>Auto-extrait</span>{%
                            endif %}
                        </label>
                        <input type="text" name="title" value="{{ form.title.value|default_if_none:'' }}"
                               class="form-input" placeholder="Titre du document">
                    </div>

                    <div class="form-field">
                        <label class="form-label">
                            Type de document
                            {% if metadata.type %}<span class="auto-badge detected"><i class="fas fa-search"></i>Auto-détecté</span>{%
                            endif %}
                        </label>
                        <input type="text" name="type" value="{{ form.type.value|default_if_none:'' }}"
                               class="form-input" placeholder="Type de document">
                    </div>

                    <div class="form-field" style="grid-column: span 2;">
                        <label class="form-label">
                            Contexte
                            {% if metadata.context %}<span class="auto-badge detected"><i class="fas fa-search"></i>Auto-détecté</span>{%
                            endif %}
                        </label>
                        <textarea name="context" rows="3" class="form-input" placeholder="Contexte du document">{{ form.context.value|default_if_none:'' }}</textarea>
                    </div>

                    <div class="form-field">
                        <label class="form-label">
                            Langue
                            {% if metadata.language %}<span class="auto-badge detected"><i class="fas fa-globe"></i>Auto-détectée</span>{%
                            endif %}
                        </label>
                        <input type="text" name="language" value="{{ form.language.value|default_if_none:'' }}"
                               class="form-input" placeholder="Langue">
                    </div>

                    <div class="form-field">
                        <label class="form-label">
                            Date de publication
                            {% if metadata.publication_date %}<span class="auto-badge extracted"><i
                                class="fas fa-calendar-check"></i>Auto-extraite</span>{% endif %}
                        </label>
                        <input type="text" name="publication_date"
                               value="{{ form.publication_date.value|default_if_none:'' }}" class="form-input"
                               placeholder="Ex: 23 January 2025">
                    </div>

                    <div class="form-field">
                        <label class="form-label">Version</label>
                        <input type="text" name="version" value="{{ form.version.value|default_if_none:'' }}"
                               class="form-input" placeholder="Version du document">
                    </div>

                    <div class="form-field">
                        <label class="form-label">
                            Source
                            {% if metadata.source %}<span class="auto-badge extracted"><i class="fas fa-database"></i>Auto-extraite</span>{%
                            endif %}
                        </label>
                        <input type="text" name="source" value="{{ form.source.value|default_if_none:'' }}"
                               class="form-input" placeholder="Source du document">
                    </div>

                    <div class="form-field">
                        <label class="form-label">Pays</label>
                        <input type="text" name="country" value="{{ form.country.value|default_if_none:'' }}"
                               class="form-input" placeholder="Pays">
                    </div>

                    <div class="form-field">
                        <label class="form-label">URL Source</label>
                        <input type="url" name="url_source" value="{{ form.url_source.value|default_if_none:'' }}"
                               class="form-input" placeholder="URL du document source">
                    </div>

                    <div id="customFields"></div>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--card-border);">
                    <button type="button" onclick="showAddFieldModal()" class="btn btn-secondary">
                        <i class="fas fa-plus"></i> Ajouter Champ
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>
                    {% if doc and not doc.is_validated and not doc.is_refused %}
                    <button type="button" class="btn btn-success" id="validateButton">
                        <i class="fas fa-check"></i> Valider
                    </button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

    <!-- Onglet Contenu structuré -->
    <div class="tab-content" id="tab-content">
        <div class="editor-card">
            <h2 class="card-title">
                <i class="fas fa-layer-group"></i>
                Éditeur de contenu structuré
            </h2>

            <div class="content-editor">
                <div class="editor-toolbar">
                    <button id="toggleEditBtn" class="btn btn-secondary">
                        <i class="fas fa-pen"></i> Mode édition
                    </button>
                    <button id="saveContentBtn" class="btn btn-primary">
                        <i class="fas fa-save"></i> Sauvegarder contenu
                    </button>
                    <button id="copyHtmlBtn" class="btn btn-secondary">
                        <i class="fas fa-copy"></i> Copier HTML
                    </button>
                    <button id="downloadHtmlBtn" class="btn btn-secondary">
                        <i class="fas fa-download"></i> Télécharger HTML
                    </button>
                    <div style="margin-left: auto; display: flex; align-items: center; gap: 1rem;">
                        <button id="zoomOutBtn" class="btn btn-secondary">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <span id="zoomLabel">100%</span>
                        <button id="zoomInBtn" class="btn btn-secondary">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button id="zoomResetBtn" class="btn btn-secondary">
                            <i class="fas fa-compress"></i>
                        </button>
                    </div>
                </div>

                <div class="editor-content" id="structuredContent">
                    {% if structured_html %}
                    {% if structured_html_css %}
                    <style>{
                    {
                        structured_html_css | safe
                    }
                    }</style>
                    {% endif %}
                    <div id="zoomContainer" class="pdf-document-container">
                        {{ structured_html|safe }}
                    </div>
                    {% elif doc.structured_html %}
                    {% if structured_html_css %}
                    <style>{
                    {
                        structured_html_css | safe
                    }
                    }</style>
                    {% endif %}
                    <div id="zoomContainer" class="pdf-document-container">
                        {{ doc.structured_html|safe }}
                    </div>
                    {% elif doc.extracted_text %}
                    <div class="empty-state">
                        <i class="fas fa-cogs"></i>
                        <h3>Contenu structuré en cours de génération</h3>
                        <p>Le texte a été extrait mais le contenu structuré n'est pas encore disponible.</p>
                        <button class="btn btn-primary" onclick="generateStructuredContent()">
                            <i class="fas fa-magic"></i> Générer le contenu structuré
                        </button>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="far fa-file"></i>
                        <h3>Aucun contenu structuré disponible</h3>
                        <p>Le contenu structuré n'a pas encore été généré pour ce document.</p>
                        <button class="btn btn-primary" onclick="window.location.reload()">
                            <i class="fas fa-refresh"></i> Actualiser
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Onglet Vue comparative -->
    <div class="tab-content" id="tab-comparison">
        <div class="editor-card" style="padding: 1rem;">
            <h2 class="card-title">
                <i class="fas fa-columns"></i>
                Vue comparative - Contenu vs PDF Original
            </h2>

            <div class="comparison-view">
                <!-- Panel contenu structuré -->
                <div class="comparison-panel">
                    <div class="panel-header structured">
                        <div>
                            <i class="fas fa-layer-group"></i>
                            Contenu Structuré
                        </div>
                        <div>
                            <button class="btn btn-secondary" style="padding: 0.5rem; font-size: 0.8rem;"
                                    onclick="syncScrolls()">
                                <i class="fas fa-link"></i> Sync
                            </button>
                        </div>
                    </div>
                    <div class="editor-content" id="structuredContent">
                        {% if structured_html %}
                        {% if structured_html_css %}
                        <style>{
                        {
                            structured_html_css | safe
                        }
                        }</style>
                        {% endif %}
                        <div id="zoomContainer" class="pdf-document-container">
                            {{ structured_html|safe }}
                        </div>
                        {% elif doc.structured_html %}
                        {% if structured_html_css %}
                        <style>{
                        {
                            structured_html_css | safe
                        }
                        }</style>
                        {% endif %}
                        <div id="zoomContainer" class="pdf-document-container">
                            {{ doc.structured_html|safe }}
                        </div>
                        {% elif doc.extracted_text %}
                        <div class="empty-state">
                            <i class="fas fa-cogs"></i>
                            <h3>Contenu structuré en cours de génération</h3>
                            <p>Le texte a été extrait mais le contenu structuré n'est pas encore disponible.</p>
                            <button class="btn btn-primary" onclick="generateStructuredContent()">
                                <i class="fas fa-magic"></i> Générer le contenu structuré
                            </button>
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="far fa-file"></i>
                            <h3>Aucun contenu structuré disponible</h3>
                            <p>Le contenu structuré n'a pas encore été généré pour ce document.</p>
                            <button class="btn btn-primary" onclick="window.location.reload()">
                                <i class="fas fa-refresh"></i> Actualiser
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Panel PDF original -->
                <div class="comparison-panel">
                    <div class="panel-header pdf">
                        <div>
                            <i class="fas fa-file-pdf"></i>
                            PDF Original
                        </div>
                        <div>
                            <button class="btn btn-secondary" style="padding: 0.5rem; font-size: 0.8rem;"
                                    onclick="refreshPdf()">
                                <i class="fas fa-refresh"></i>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        {% if doc and doc.file %}
                        <iframe
                                class="pdf-frame"
                                id="pdfFrame"
                                src="{% url 'rawdocs:view_original_document' doc.id %}#view=FitH&toolbar=1&navpanes=0&scrollbar=1"
                                title="PDF Original">
                        </iframe>
                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-file-pdf"></i>
                            <p>PDF original non disponible</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Onglet Historique -->
    <div class="tab-content" id="tab-history">
        <div class="editor-card">
            <h2 class="card-title">
                <i class="fas fa-history"></i>
                Historique des modifications
            </h2>

            <div style="max-height: 600px; overflow-y: auto;">
                {% for log in logs %}
                <div class="history-entry">
                    <div class="history-field">{{ log.field_name|title }}</div>
                    <div class="history-change">
                        <span style="color: var(--text-muted);">{{ log.old_value|default:'(vide)' }}</span>
                        <i class="fas fa-arrow-right" style="margin: 0 0.5rem; color: var(--primary);"></i>
                        <span style="color: var(--text); font-weight: 600;">{{ log.new_value|default:'(vide)' }}</span>
                    </div>
                    <div class="history-meta">
                        <span><i class="fas fa-user"></i> {{ log.modified_by.username }}</span>
                        <span>{{ log.modified_at|date:"d/m/Y H:i" }}</span>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <i class="fas fa-history"></i>
                    <h3>Aucune modification enregistrée</h3>
                    <p>L'historique des modifications apparaîtra ici après les premières éditions.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Actions flottantes -->
<div class="floating-actions">
    <button class="floating-btn" onclick="scrollToTop()" title="Haut de page">
        <i class="fas fa-arrow-up"></i>
    </button>
    <button class="floating-btn" onclick="toggleFullscreen()" title="Plein écran">
        <i class="fas fa-expand"></i>
    </button>
</div>

<!-- Modal d'ajout de champ personnalisé -->
<div id="addFieldModal"
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:2000; backdrop-filter: blur(5px);">
    <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:2rem; border-radius:20px; min-width:400px; box-shadow: var(--shadow-lg);">
        <h3 style="margin-bottom: 1.5rem; color: var(--primary-dark);">
            <i class="fas fa-plus"></i> Ajouter un champ personnalisé
        </h3>

        <div style="margin-bottom:1rem;">
            <label class="form-label">Nom du champ :</label>
            <input type="text" id="newFieldName" class="form-input" placeholder="Nom du champ">
        </div>

        <div style="margin-bottom:2rem;">
            <label class="form-label">Type de champ :</label>
            <select id="newFieldType" class="form-input">
                <option value="text">Texte</option>
                <option value="textarea">Texte long</option>
                <option value="date">Date</option>
                <option value="number">Nombre</option>
            </select>
        </div>

        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
            <button onclick="hideAddFieldModal()" class="btn btn-secondary">Annuler</button>
            <button onclick="addCustomField()" class="btn btn-primary">Ajouter</button>
        </div>
    </div>
</div>

<!-- Toast container -->
<div id="toastContainer"></div>

<script>
    // Variables globales
    let currentTab = 'metadata';
    let editMode = false;
    let zoom = 1.0;
    const Z_MIN = 0.25;
    const Z_MAX = 3.0;
    const Z_STEP = 0.1;

    // Utilitaires
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function showToast(type, message) {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}-circle"></i>
        ${message}
    `;

        container.appendChild(toast);

        // Animation d'entrée
        setTimeout(() => toast.classList.add('show'), 100);

        // Animation de sortie
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => container.removeChild(toast), 300);
        }, 3000);
    }

    // Gestion des onglets
    function initTabs() {
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                switchTab(tabId);
            });
        });
    }

    function switchTab(tabId) {
        currentTab = tabId;

        // Mise à jour des boutons
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

        // Mise à jour du contenu
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`tab-${tabId}`).classList.add('active');

        // Actions spécifiques par onglet
        if (tabId === 'content') {
            initContentEditor();
        } else if (tabId === 'comparison') {
            initComparison();
        }
    }

    // Gestion des métadonnées
    function reextractMetadata() {
        if (!confirm("Relancer l'extraction automatique des métadonnées ?")) return;

        const docId = "{{ doc.id|default:'' }}";
        if (!docId) {
            showToast('error', "Le document doit être sauvegardé avant de réextraire les métadonnées.");
            return;
        }

        showToast('warning', 'Réextraction en cours...');

        fetch(`/edit/${docId}/reextract/`, {
            method: 'POST',
            headers: {'X-CSRFToken': getCookie('csrftoken')}
        })
                .then(r => r.json())
                .then(data => {
                    if (!data.success) {
                        showToast('error', 'Erreur: ' + (data.error || 'réextraction'));
                        return;
                    }

                    const m = data.metadata || {};
                    const fields = ['title', 'type', 'context', 'language', 'publication_date', 'version', 'source', 'url_source', 'country'];

                    fields.forEach(field => {
                        const input = document.querySelector(`[name="${field}"]`);
                        if (input) input.value = m[field] || '';
                    });

                    showToast('success', 'Réextraction terminée et champs mis à jour.');
                })
                .catch(err => showToast('error', 'Erreur réseau: ' + err));
    }

    // Gestion des champs personnalisés
    function showAddFieldModal() {
        document.getElementById('addFieldModal').style.display = 'block';
    }

    function hideAddFieldModal() {
        document.getElementById('addFieldModal').style.display = 'none';
        document.getElementById('newFieldName').value = '';
        document.getElementById('newFieldType').value = 'text';
    }

    function addCustomField() {
        const name = document.getElementById('newFieldName').value.trim();
        const type = document.getElementById('newFieldType').value;

        if (!name) {
            showToast('error', 'Veuillez entrer un nom de champ');
            return;
        }

        const docId = "{{ doc.id }}";

        fetch('{% url "rawdocs:add_field_ajax" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                name: name,
                type: type,
                doc_id: docId
            })
        })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        hideAddFieldModal();
                        addFieldToForm(name, type);
                        showToast('success', data.message);
                    } else {
                        showToast('error', data.message);
                    }
                })
                .catch(err => showToast('error', 'Erreur lors de l\'ajout du champ'));
    }

    function addFieldToForm(name, type, value = '') {
        const container = document.getElementById('customFields');
        if (document.getElementById(`custom_${name}`)) return;

        const fieldDiv = document.createElement('div');
        fieldDiv.className = 'form-field';

        let inputHtml = '';
        const safeValue = value ? value.replace(/</g, '&lt;').replace(/>/g, '&gt;') : '';

        if (type === 'textarea') {
            inputHtml = `<textarea name="custom_${name}" id="custom_${name}" class="form-input" rows="3" placeholder="${name}">${safeValue}</textarea>`;
        } else if (type === 'date') {
            inputHtml = `<input type="date" name="custom_${name}" id="custom_${name}" value="${safeValue}" class="form-input">`;
        } else if (type === 'number') {
            inputHtml = `<input type="number" name="custom_${name}" id="custom_${name}" value="${safeValue}" class="form-input">`;
        } else {
            inputHtml = `<input type="text" name="custom_${name}" id="custom_${name}" value="${safeValue}" class="form-input" placeholder="${name}">`;
        }

        fieldDiv.innerHTML = `
        <label class="form-label">
            ${name}
            <span class="auto-badge custom"><i class="fas fa-plus"></i>Personnalisé</span>
        </label>
        ${inputHtml}
    `;

        container.appendChild(fieldDiv);
    }

    // Éditeur de contenu
    function initContentEditor() {
        const toggleBtn = document.getElementById('toggleEditBtn');
        const saveBtn = document.getElementById('saveContentBtn');
        const copyBtn = document.getElementById('copyHtmlBtn');
        const downloadBtn = document.getElementById('downloadHtmlBtn');

        if (toggleBtn && !toggleBtn.hasAttribute('data-initialized')) {
            toggleBtn.setAttribute('data-initialized', 'true');
            toggleBtn.addEventListener('click', toggleEditMode);
        }

        if (saveBtn && !saveBtn.hasAttribute('data-initialized')) {
            saveBtn.setAttribute('data-initialized', 'true');
            saveBtn.addEventListener('click', saveContent);
        }

        if (copyBtn && !copyBtn.hasAttribute('data-initialized')) {
            copyBtn.setAttribute('data-initialized', 'true');
            copyBtn.addEventListener('click', copyHtml);
        }

        if (downloadBtn && !downloadBtn.hasAttribute('data-initialized')) {
            downloadBtn.setAttribute('data-initialized', 'true');
            downloadBtn.addEventListener('click', downloadHtml);
        }

        initZoomControls();
    }

    function toggleEditMode() {
        editMode = !editMode;
        const container = document.getElementById('zoomContainer');
        const toggleBtn = document.getElementById('toggleEditBtn');

        if (container) {
            document.body.classList.toggle('edit-mode', editMode);

            const editableSelectors = ['.editable-content', '.pdf-text-element', '.pdf-cell'];
            editableSelectors.forEach(sel => {
                container.querySelectorAll(sel).forEach(el => {
                    el.setAttribute('contenteditable', editMode ? 'true' : 'false');
                    el.spellcheck = false;
                });
            });
        }

        if (toggleBtn) {
            toggleBtn.innerHTML = editMode ?
                    '<i class="fas fa-eye"></i> Mode lecture' :
                    '<i class="fas fa-pen"></i> Mode édition';
            toggleBtn.className = editMode ? 'btn btn-warning' : 'btn btn-secondary';
        }

        showToast('success', editMode ? 'Mode édition activé' : 'Mode lecture activé');
    }

    function saveContent() {
        const container = document.getElementById('zoomContainer');
        if (!container) return;

        const saveUrl = "{% if doc and doc.id %}{% url 'rawdocs:save_structured_edits' doc.id %}{% endif %}";
        if (!saveUrl) {
            showToast('error', 'URL de sauvegarde non disponible');
            return;
        }

        const formatted_content = container.innerHTML;
        const payload = {formatted_content, extracted_content: ''};

        showToast('warning', 'Sauvegarde en cours...');

        fetch(saveUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify(payload)
        })
                .then(resp => resp.json())
                .then(data => {
                    if (data && data.success) {
                        showToast('success', data.message || 'Contenu sauvegardé avec succès');
                    } else {
                        showToast('error', (data && data.error) ? data.error : 'Erreur lors de la sauvegarde');
                    }
                })
                .catch(e => showToast('error', 'Erreur réseau lors de la sauvegarde'));
    }

    function copyHtml() {
        const container = document.getElementById('zoomContainer');
        if (!container) return;

        const html = container.innerHTML;

        if (navigator.clipboard) {
            navigator.clipboard.writeText(html)
                    .then(() => showToast('success', 'HTML copié dans le presse-papiers'))
                    .catch(() => fallbackCopy(html));
        } else {
            fallbackCopy(html);
        }
    }

    function fallbackCopy(text) {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try {
            document.execCommand('copy');
            showToast('success', 'HTML copié');
        } catch (err) {
            showToast('error', 'Impossible de copier le HTML');
        }
        document.body.removeChild(ta);
    }

    function downloadHtml() {
        const container = document.getElementById('zoomContainer');
        if (!container) return;

        const html = container.innerHTML;
        const blob = new Blob([html], {type: 'text/html;charset=utf-8'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const filename = `document_{{ doc.id|default:'0' }}_structured.html`;

        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showToast('success', 'HTML téléchargé');
    }

    // Contrôles de zoom
    function initZoomControls() {
        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomOutBtn = document.getElementById('zoomOutBtn');
        const zoomResetBtn = document.getElementById('zoomResetBtn');

        if (zoomInBtn && !zoomInBtn.hasAttribute('data-initialized')) {
            zoomInBtn.setAttribute('data-initialized', 'true');
            zoomInBtn.addEventListener('click', () => setZoom(zoom + Z_STEP));
        }

        if (zoomOutBtn && !zoomOutBtn.hasAttribute('data-initialized')) {
            zoomOutBtn.setAttribute('data-initialized', 'true');
            zoomOutBtn.addEventListener('click', () => setZoom(zoom - Z_STEP));
        }

        if (zoomResetBtn && !zoomResetBtn.hasAttribute('data-initialized')) {
            zoomResetBtn.setAttribute('data-initialized', 'true');
            zoomResetBtn.addEventListener('click', () => setZoom(1.0));
        }
    }

    function setZoom(val) {
        zoom = Math.min(Z_MAX, Math.max(Z_MIN, val));
        applyZoom();
    }

    function applyZoom() {
        const container = document.getElementById('zoomContainer');
        const label = document.getElementById('zoomLabel');

        if (container) {
            container.style.transform = `scale(${zoom})`;
        }

        if (label) {
            label.textContent = Math.round(zoom * 100) + '%';
        }
    }

    // Vue comparative
    function initComparison() {
        // Initialisation de la vue comparative si nécessaire
    }

    function syncScrolls() {
        showToast('success', 'Synchronisation des défilements activée');
    }

    function refreshPdf() {
        const pdfFrame = document.getElementById('pdfFrame');
        if (pdfFrame) {
            pdfFrame.src = pdfFrame.src;
            showToast('success', 'PDF actualisé');
        }
    }

    // Fonction pour générer le contenu structuré
    function generateStructuredContent() {
        const docId = "{{ doc.id }}";
        if (!docId) {
            showToast('error', 'ID du document non disponible');
            return;
        }

        showToast('warning', 'Génération du contenu structuré en cours...');

        // Ajout d'un indicateur de chargement
        const button = event.target;
        const originalContent = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Génération...';
        button.disabled = true;

        fetch(`/documents/${docId}/generate-structured/`, {
            method: 'POST',
            headers: {'X-CSRFToken': getCookie('csrftoken')}
        })
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showToast('success', 'Contenu structuré généré avec succès');
                        // Recharger la page pour afficher le nouveau contenu
                        setTimeout(() => window.location.reload(), 1000);
                    } else {
                        showToast('error', 'Erreur: ' + (data.error || 'génération échouée'));
                        button.innerHTML = originalContent;
                        button.disabled = false;
                    }
                })
                .catch(err => {
                    showToast('error', 'Erreur réseau: ' + err);
                    button.innerHTML = originalContent;
                    button.disabled = false;
                });
    }

    // Fonctions utilitaires
    function scrollToTop() {
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
        } else {
            document.exitFullscreen();
        }
    }

    // Validation du document
    function submitValidation() {
        const form = document.getElementById('metadataForm');
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'validate_document';
        input.value = '{{ doc.id }}';
        form.appendChild(input);
        form.action = '{% url "rawdocs:validate_document" 0 %}'.replace('0', '{{ doc.id }}');
        form.method = 'POST';
        form.submit();
    }

    // Raccourcis clavier
    function initKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
            const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
            const accel = isMac ? e.metaKey : e.ctrlKey;

            if (accel) {
                switch (e.key) {
                    case '1':
                        if (e.shiftKey) {
                            e.preventDefault();
                            switchTab('metadata');
                        }
                        break;
                    case '2':
                        if (e.shiftKey) {
                            e.preventDefault();
                            switchTab('content');
                        }
                        break;
                    case '3':
                        if (e.shiftKey) {
                            e.preventDefault();
                            switchTab('comparison');
                        }
                        break;
                    case '4':
                        if (e.shiftKey) {
                            e.preventDefault();
                            switchTab('history');
                        }
                        break;
                    case 's':
                        e.preventDefault();
                        if (currentTab === 'metadata') {
                            document.getElementById('metadataForm').dispatchEvent(new Event('submit'));
                        } else if (currentTab === 'content') {
                            saveContent();
                        }
                        break;
                    case '=':
                    case '+':
                        if (currentTab === 'content') {
                            e.preventDefault();
                            setZoom(zoom + Z_STEP);
                        }
                        break;
                    case '-':
                        if (currentTab === 'content') {
                            e.preventDefault();
                            setZoom(zoom - Z_STEP);
                        }
                        break;
                    case '0':
                        if (currentTab === 'content') {
                            e.preventDefault();
                            setZoom(1.0);
                        }
                        break;
                }
            }
        });
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', function () {
        initTabs();
        initKeyboardShortcuts();
        applyZoom();

        // Charger les champs personnalisés
        {%
            if custom_fields_data %
        }
        {%
            for field in custom_fields_data %
        }
        addFieldToForm('{{ field.name|escapejs }}', '{{ field.type|escapejs }}', '{{ field.value|escapejs }}');
        {%
            endfor %
        }
        {%
            endif %
        }

        // Debug: afficher les variables disponibles
        console.log('Variables disponibles:', {
            doc_id: '{{ doc.id }}',
            has_metadata: {
        {
            metadata | yesno
        :
            "true,false"
        }
    },
        has_structured_html: {
            {
                structured_html | yesno
            :
                "true,false"
            }
        }
    ,
        form_title: '{{ form.title.value|default:"" }}',
    })
        ;

        // Popup de validation
        const validateButton = document.getElementById('validateButton');
        if (validateButton) {
            validateButton.addEventListener('click', function () {
                const popup = document.createElement('div');
                popup.innerHTML = `
                <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 2000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 20px; padding: 2rem; max-width: 500px; text-align: center; box-shadow: var(--shadow-lg);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--primary-dark); margin-bottom: 1rem;">Confirmation de validation</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 2rem;">Êtes-vous sûr de vouloir valider ce document ? Cette action est irréversible.</p>
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-secondary" onclick="this.closest('div').parentElement.remove()">Annuler</button>
                            <button class="btn btn-success" onclick="submitValidation(); this.closest('div').parentElement.remove();">Valider</button>
                        </div>
                    </div>
                </div>
            `;
                document.body.appendChild(popup);
            });
        }

        showToast('success', 'Interface d\'édition chargée avec succès');

        console.log(`
🚀 Raccourcis clavier disponibles:
   Ctrl/Cmd + Shift + 1/2/3/4: Basculer entre les onglets
   Ctrl/Cmd + S: Sauvegarder (selon l'onglet actif)
   Ctrl/Cmd + Plus/Moins: Zoom (onglet contenu)
   Ctrl/Cmd + 0: Reset zoom (onglet contenu)
    `);
    });
</script>

{% endblock %}